import jwtDecode from "jwt-decode";

import { LOGIN, LOGOUT } from "./actions/actions";

export const calculateRemainingTime = (token) => {
  const decodedToken = jwtDecode(token);
  const expTimestamp = decodedToken.exp * 1000;
  const currentTime = new Date().getTime();
  return expTimestamp - currentTime;
};

const initialAuthState = {
  token: localStorage.getItem("token"),
  isLoggedIn: !!localStorage.getItem("token"),
};

//let logoutTimer;

function loginHandler(action) {
  localStorage.setItem("token", action.token);
  return {
    token: action.token,
    isLoggedIn: action.isLoggedIn,
  };
}

function logoutHandler() {
  localStorage.removeItem("token");
  return {
    token: null,
    isLoggedIn: false,
  };
}

export default function authReducer(state = initialAuthState, action) {
  switch (action.type) {
    case LOGIN:
      return loginHandler(action);
    case LOGOUT:
      return logoutHandler();
    default:
      return state;
  }
}
