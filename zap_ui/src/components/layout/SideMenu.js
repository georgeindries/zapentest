import React, { useState } from "react";
import { NavLink, useLocation } from "react-router-dom";
import { Layout, Menu } from "antd";

import { Icon } from "@iconify/react";

import Logo from "../../utils/logo/Logo";
import classes from "./SideMenu.module.css";
import { useDispatch, useSelector } from "react-redux";
import axios from "axios";
import { LOGOUT } from "../../store/actions/actions";
import { useHistory } from "react-router-dom";

const { Sider } = Layout;
const { Item } = Menu;

const SideMenu = () => {
  const [collapsed, setCollapsed] = useState(false);
  const location = useLocation();
  const dispatch = useDispatch();
  const history = useHistory();
  const token = useSelector((state) => state.auth.token);

  const onCollapse = () => {
    setCollapsed(!collapsed);
  };

  const logoutHandler = () => {
    axios({
      method: "get",
      url: "http://localhost:5000/auth/logout",
      headers: {
        Authorization: `Bearer ${token}`,
      },
    })
      .then(() => {
        dispatch({
          type: LOGOUT,
          token: "",
          isLoggedIn: false,
        });
        history.replace("/");
      })
      .catch((err) => console.log(err));
  };

  return (
    <Sider collapsible collapsed={collapsed} onCollapse={onCollapse}>
      <Logo type="logoSider" />
      <Menu
        theme="dark"
        mode="inline"
        defaultSelectedKeys={[location.pathname]}
        className={`${classes.enlarge}`}
      >
        <Item
          key="/home"
          icon={
            <Icon icon="ic:outline-dashboard" className={classes.enlarge} />
          }
        >
          <span>Dashboard</span>
          <NavLink to="/" />
        </Item>

        <Item
          key="/spider"
          icon={
            <Icon
              icon="healthicons:animal-spider-outline"
              className={classes.enlarge}
            />
          }
        >
          <span>Spider Scans</span>
          <NavLink to="/spider" />
        </Item>

        <Item
          key="/scan"
          icon={
            <Icon
              icon="ant-design:thunderbolt-outlined"
              className={classes.enlarge}
            />
          }
        >
          <span>Active Scans</span>
          <NavLink to="/scan" />
        </Item>

        <Item
          key="logout"
          icon={
            <Icon
              icon="ant-design:logout-outlined"
              className={classes.enlarge}
            />
          }
          onClick={logoutHandler}
        >
          <span>Logout</span>
        </Item>
      </Menu>
    </Sider>
  );
};

export default SideMenu;
