const { getPgClient } = require('../connect');

exports.getUserByEmail = async (email) => {
  const client = getPgClient();
  const query = {
    name: 'fetch-user',
    text: 'SELECT * FROM users WHERE email = $1',
    values: [email],
  };
  await client.connect();
  return client
    .query(query)
    .then((res) => res.rows[0])
    .catch((err) => {
      throw err;
    })
    .finally(async () => {
      await client.end();
    });
};

exports.saveUser = async (email, password, name) => {
  const client = getPgClient();
  const query = {
    name: 'save-user',
    text: 'INSERT INTO users(email, password, name) VALUES($1, $2, $3)',
    values: [email, password, name],
  };
  await client.connect();
  return client
    .query(query)
    .then((res) => res)
    .catch((err) => {
      throw err;
    })
    .finally(async () => {
      await client.end();
    });
};
